<%= render :partial => 'shared/map_head' %>
<script type="text/javascript">
//<![CDATA[
<% if params[:action] == 'edit' %>var geoXml = new GGeoXml("http://<%= URL_BASE %>/paths/<%= @track.filename %>.kml?a=<%= Time.now.strftime('%j%H%M%S') %>");<% end %>
function load(lt,ln,zm) {
  if (GBrowserIsCompatible()) {
    if (!zm) {
      lt = <%= @track.area.zoom != 0 ? @track.area.latitude : -40.913512 %>;
      ln = <%= @track.area.zoom != 0 ? @track.area.longitude : 172.705078 %>;
      zm = <%= @track.area.zoom != 0 ? @track.area.zoom : 5 %>; }
    var map = new GMap2(document.getElementById("map"));
    map.addControl(new GSmallMapControl());
    map.addControl(new GMapTypeControl());
    map.addControl(new GScaleControl());
    map.addMapType(G_PHYSICAL_MAP);
    map.addMapType(G_SATELLITE_3D_MAP);
    GEvent.addListener(map, "moveend", function() {
      var center = map.getCenter();
      document.getElementById("track_latitude").value = center.lat();
      document.getElementById("track_longitude").value = center.lng();
      document.getElementById("track_zoom").value = map.getZoom();
    });
    map.setCenter(new GLatLng(lt, ln), zm, G_SATELLITE_MAP);
    <% if params[:action] == 'edit' %>map.addOverlay(geoXml);<% end %>
    map.setMapType(<%= user_map_style %>);
  } else { document.getElementById("map").innerHTML="This website uses Google Maps, which appear not to work with your browser. See the FAQ."; }
}
//]]>
</script>